<!DOCTYPE HTML>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"/>
<script>
(function(window, document, setTimeout){

// https://github.com/jgallen23/querystring

var querystring = (function(encodeURIComponent, decodeURIComponent){

var querystring = {
  parse : function(string){
    var parsed = {};
    string = (string !== undefined) ? string :  window.location.search;

    if (typeof string === "string" && string.length > 0){
      if (string[0] === '?') {
        string = string.substring(1);
      }

      string = string.split('&');

      for (var i = 0, length = string.length; i < length; i++){
        var element = string[i],
            eqPos = element.indexOf('='),
            keyValue, elValue;

        if (eqPos >= 0){
          keyValue = element.substr(0,eqPos);
          elValue = element.substr(eqPos +1);
        }
        else {
          keyValue = element;
          elValue = '';
        }

        elValue = decodeURIComponent(elValue);

        if (parsed[keyValue] === undefined){
          parsed[keyValue] = elValue;
        }
        else if (parsed[keyValue] instanceof Array) {
          parsed[keyValue].push(elValue);
        }
        else {
          parsed[keyValue] = [parsed[keyValue], elValue];
        }
      }
    }

    return parsed;
  },
  stringify : function(obj){
    var string = [];

    if (!!obj && obj.constructor === Object){
      for (var prop in obj){
        if (obj[prop] instanceof Array){
          for (var i = 0, length = obj[prop].length; i < length; i++){
            string.push([encodeURIComponent(prop),encodeURIComponent(obj[prop][i])].join('='));
          }
        }
        else {
          string.push([encodeURIComponent(prop),encodeURIComponent(obj[prop])].join('='));
        }
      }
    }

    return string.join('&');
  }
};

return querystring;
}(encodeURIComponent, decodeURIComponent));


// https://github.com/RubenVerborgh/promiscuous

(function(window, setImmediate){

/**@license MIT-promiscuous-Â©Ruben Verborgh*/
window.Promise = window.Promise || (function (func, obj) {
  // Type checking utility function
  function is(type, item) { return (typeof item)[0] == type; }

  // Creates a promise, calling callback(resolve, reject), ignoring other parameters.
  function Promise(callback, handler) {
    // The `handler` variable points to the function that will
    // 1) handle a .then(resolved, rejected) call
    // 2) handle a resolve or reject call (if the first argument === `is`)
    // Before 2), `handler` holds a queue of callbacks.
    // After 2), `handler` is a finalized .then handler.
    handler = function pendingHandler(resolved, rejected, value, queue, then, i) {
      queue = pendingHandler.q;

      // Case 1) handle a .then(resolved, rejected) call
      if (resolved != is) {
        return Promise(function (resolve, reject) {
          queue.push({ p: this, r: resolve, j: reject, 1: resolved, 0: rejected });
        });
      }

      // Case 2) handle a resolve or reject call
      // (`resolved` === `is` acts as a sentinel)
      // The actual function signature is
      // .re[ject|solve](<is>, success, value)

      // Check if the value is a promise and try to obtain its `then` method
      if (value && (is(func, value) | is(obj, value))) {
        try { then = value.then; }
        catch (reason) { rejected = 0; value = reason; }
      }
      // If the value is a promise, take over its state
      if (is(func, then)) {
        function valueHandler(resolved) {
          return function (value) { then && (then = 0, pendingHandler(is, resolved, value)); };
        }
        try { then.call(value, valueHandler(1), rejected = valueHandler(0)); }
        catch (reason) { rejected(reason); }
      }
      // The value is not a promise; handle resolve/reject
      else {
        // Replace this handler with a finalized resolved/rejected handler
        handler = function (Resolved, Rejected) {
          // If the Resolved or Rejected parameter is not a function,
          // return the original promise (now stored in the `callback` variable)
          if (!is(func, (Resolved = rejected ? Resolved : Rejected)))
            return callback;
          // Otherwise, return a finalized promise, transforming the value with the function
          return Promise(function (resolve, reject) { finalize(this, resolve, reject, value, Resolved); });
        };
        // Resolve/reject pending callbacks
        i = 0;
        while (i < queue.length) {
          then = queue[i++];
          // If no callback, just resolve/reject the promise
          if (!is(func, resolved = then[rejected]))
            (rejected ? then.r : then.j)(value);
          // Otherwise, resolve/reject the promise with the result of the callback
          else
            finalize(then.p, then.r, then.j, value, resolved);
        }
      }
    };
    // The queue of pending callbacks; garbage-collected when handler is resolved/rejected
    handler.q = [];

    // Create and return the promise (reusing the callback variable)
    callback.call(callback = { then:    function (resolved, rejected) { return handler(resolved, rejected); },
                               "catch": function (rejected)           { return handler(0,        rejected); } },
                  function (value)  { handler(is, 1,  value); },
                  function (reason) { handler(is, 0, reason); });
    return callback;
  }

  // Finalizes the promise by resolving/rejecting it with the transformed value
  function finalize(promise, resolve, reject, value, transform) {
    setImmediate(function () {
      try {
        // Transform the value through and check whether it's a promise
        value = transform(value);
        transform = value && (is(obj, value) | is(func, value)) && value.then;
        // Return the result if it's not a promise
        if (!is(func, transform))
          resolve(value);
        // If it's a promise, make sure it's not circular
        else if (value == promise)
          reject(TypeError());
        // Take over the promise's state
        else
          transform.call(value, resolve, reject);
      }
      catch (error) { reject(error); }
    });
  }

  // Creates a resolved promise
  Promise.resolve = ResolvedPromise;
  function ResolvedPromise(value) { return Promise(function (resolve) { resolve(value); }); }

  // Creates a rejected promise
  Promise.reject = function (reason) { return Promise(function (resolve, reject) { reject(reason); }); };

  // Transforms an array of promises into a promise for an array
  Promise.all = function (promises) {
    return Promise(function (resolve, reject, count, values) {
      // Array of collected values
      values = [];
      // Resolve immediately if there are no promises
      count = promises.length || resolve(values);
      // Transform all elements (`map` is shorter than `forEach`)
      promises.map(function (promise, index) {
        ResolvedPromise(promise).then(
          // Store the value and resolve if it was the last
          function (value) {
            values[index] = value;
            --count || resolve(values);
          },
          // Reject if one element fails
          reject);
      });
    });
  };

  return Promise;
})('f', 'o');

}(window, window.setImmediate || function(func){ setTimeout(func, 0) }));

// see struct templateParams in interstitial_templates.go

/**
 * This function is basically a glorified version of the following code. It is required to make the code sufficiently complex such that it doesn't get minified:
 *
 *    '{{.IsPromoteInstall}}' === 'true'
 *
 * @param  {string}
 * @param  {boolean}
 * @return {boolean}
 */
function parseBoolean(str, defaultValue) {
  try {
    return JSON.parse(str);
  }
  catch (e){
    return defaultValue;
  }
}

var APP_LINK = 'twitter://user?screen_name=bitly';
var FALLBACK_URL = 'http://www.yahoo.com/';
var APP_INSTALL_URL = 'https://play.google.com/';
var ICON_URL = 'https://bitly.com/favicon.ico';
var APP_NAME = 'Test';
var IS_PROMOTE_INSTALL = parseBoolean('true', true);
var BASE_URL = window.location.href;

var BITLY_SVG = '<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="80%" height="34" viewBox="0 0 111 55" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns"> <title>New Logo! (white)</title> <defs></defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"> <g id="Mobile-Safari-with-content-Copy" sketch:type="MSArtboardGroup" transform="translate(-345.000000, -961.000000)" fill="#C3C3C3"> <g id="Imported-EPS-+-POWERED-BY-+-New-Logo!-(white)" sketch:type="MSLayerGroup" transform="translate(185.500000, 961.000000)"> <g id="New-Logo!-(white)" transform="translate(160.000000, 0.000000)" sketch:type="MSShapeGroup"> <path d="M57.4024439,36.9638308 C51.8994264,36.9638308 48.8633167,33.7108955 48.8633167,29.6570398 C48.8633167,28.0073134 48.9398504,15.7513433 48.9398504,15.7513433 C47.1400748,15.7513433 46.2537656,14.8081343 46.2537656,13.6298756 C46.2537656,12.4513433 47.1921945,11.3614677 48.7321945,11.3614677 C48.7321945,11.3614677 48.7349377,7.26355721 48.7349377,5.56649254 C48.7349377,3.63355721 50.2387282,2.03089552 52.1838903,2.03089552 C54.1293267,2.03089552 55.6742643,3.63355721 55.6742643,5.56649254 C55.6742643,7.02768657 55.5464339,9.04243781 55.5516459,11.2747264 C55.713217,11.2728109 57.1026185,11.2728109 59.142419,11.2487313 C61.0338155,11.2265672 61.8043641,12.280597 61.8043641,13.6003234 C61.8043641,14.9203234 60.7858354,15.8413682 59.4578803,15.8465672 C58.2270324,15.8514925 55.5085786,15.8367164 55.5085786,15.8367164 C55.3845885,19.7452736 55.268005,24.4572139 55.268005,28.228408 C55.268005,29.5880846 56.2086284,31.1425871 58.485985,31.1425871 C63.7042643,31.1425871 65.2088778,25.8877612 65.2088778,15.9866667 C65.2088778,14.6669403 66.253192,13.6298756 67.5816958,13.6298756 C68.9099252,13.6298756 69.9534165,14.6669403 69.9534165,15.9866667 C69.9534165,28.9499751 66.6536908,36.9638308 57.4024439,36.9638308 Z M96.3139152,34.5613433 C96.3139152,34.5613433 94.3857606,37.083408 89.4996758,36.9616418 C83.0198254,36.7999254 80.0169077,31.6690547 79.6989776,26.3906965 C79.4581297,22.3907463 79.5673067,19.5630348 79.5673067,16.9706468 C79.5673067,15.0379851 80.8576808,13.4733582 82.8033915,13.4733582 C84.7485536,13.4733582 85.8921696,15.0760199 85.8921696,17.0086816 C85.8921696,19.6010697 85.732793,21.8776866 85.7042643,24.7059453 C85.6702494,28.1175871 86.8391022,31.1234328 89.6853865,31.1152239 C92.4181047,31.1072886 95.4193766,29.9596766 95.4926185,24.1157214 C95.528005,21.2877363 95.4314464,19.6010697 95.4314464,17.0086816 C95.4314464,15.0760199 96.7813466,13.4733582 98.7270574,13.4733582 C100.671671,13.4733582 102.022943,15.0760199 102.022943,17.0086816 C102.022943,19.6010697 101.810623,22.1699254 101.810623,26.17699 C101.810623,26.17699 101.691297,34.2707463 101.976309,36.0622139 C102.868379,35.7658706 104.15601,34.895995 105.5199,32.7871144 C106.343392,31.5136318 107.917681,31.2408209 108.88793,31.8047761 C110.223566,32.580796 110.17611,34.0978109 109.676584,35.2060199 C108.387307,38.0671144 106.710973,39.8180846 102.472269,41.2672388 C102.485436,46.1198259 102.146658,53.2788557 93.1527182,54.5725871 C85.4502494,55.6805224 81.9664589,51.2249751 81.9546633,47.4332587 C81.9362843,41.4464677 87.9341646,39.7028856 96.5915212,37.5283333 L96.3139152,34.5613433 Z M97.15798,42.305398 C92.7818454,43.2472388 87.2994015,44.6233333 87.3633167,47.3114925 C87.4231172,49.8319154 90.0321197,50.290796 92.2071571,49.8423134 C96.7251122,48.9108706 97.249601,46.1994527 97.15798,42.305398 L97.15798,42.305398 Z" id="Fill-1"></path> <path d="M34.6020613,17.2035585 C34.5876774,16.1480781 34.578404,15.4796269 34.578404,15.4796269 C34.578404,13.5469652 35.8281796,11.9100995 37.7730673,11.9100995 C39.7182294,11.9100995 41.0105237,13.6577861 40.9411222,15.5031592 C40.7076808,21.7165174 40.613591,25.8067662 40.613591,27.9706468 C40.613591,29.2230597 41.2985536,31.1425871 43.32601,31.1425871 C48.0200748,31.1425871 48.9886783,26.8041542 48.9886783,16.3306219 C48.9886783,15.0108955 50.3097756,13.9738308 51.638005,13.9738308 C52.9665087,13.9738308 54.01,15.0108955 54.01,16.3306219 C54.01,32.1777363 51.24601,36.9818905 42.2600249,36.9818905 C38.6944789,36.9818905 34.9465238,34.7945166 34.7690299,30.7019397 C30.7138196,34.9825281 24.4610746,37.0221144 16.4772319,37.0221144 C8.42446384,37.0221144 5.06109726,31.5456468 5.06109726,27.28 C5.28301746,11.8006468 4.87758105,6.85830846 4.86139651,6.44348259 C4.84054863,5.90360697 4.82052369,5.05890547 4.29301746,5.00253731 C3.97289277,4.96833333 3.76633416,5.0660199 3.39793017,5.52298507 C2.84600998,6.25467662 1.73147132,6.54445274 1.05391521,6.15343284 C0.234538653,5.68059701 0.0820199501,4.63723881 0.496508728,3.67706468 C1.64643392,1.11669154 3.49037406,-0.0161442786 5.97511222,0.0191542289 C10.2686783,0.0801741294 11.5003491,2.87723881 11.5003491,6.37151741 C11.5003491,6.37151741 11.4048878,11.4052488 11.4048878,14.239801 C12.9234913,13.0054478 15.1547631,11.6810697 18.8818703,11.6810697 C26.6424938,11.6810697 31.5691771,21.2650249 26.5067082,30.4341542 C32.9949464,27.4494396 34.3498778,22.3082298 34.6020613,17.2035585 Z M79.6833416,16.216791 C79.6877307,16.2091294 81.9052868,14.7011443 83.2335162,14.7011443 C84.5622943,14.7011443 84.3680798,14.9323632 84.3680798,16.2523632 C84.3680798,30.394204 81.8021446,36.9944776 72.6260599,36.9944776 C68.6378055,36.9944776 64.9153616,34.0247512 64.9153616,30.3950249 C64.9153616,28.9808955 65.1526434,26.1526368 65.1526434,24.7385075 C65.1526434,11.0681343 64.9400499,8.17885572 64.9400499,4.17179104 C64.9400499,2.23912935 66.5532918,0.511691542 68.4984539,0.511691542 C70.4441646,0.511691542 71.8788279,2.06291045 71.8788279,3.99557214 C71.8788279,8.00236318 71.4451372,13.8304478 71.3200499,28.9220647 C71.3096259,30.1848756 71.9273815,31.0741791 73.5669576,31.0741791 C78.6903242,31.0741791 79.4825436,24.5986816 79.6833416,16.216791 Z M16.4772319,31.0377861 C13.4734913,31.0900498 11.5579551,29.906592 11.4238155,27.2980597 C11.373616,26.3192786 11.3895262,25.4808706 11.4375312,24.8520647 C11.7280299,21.0400995 14.1356858,18.5708458 16.7830923,18.0443781 C20.076783,17.3895771 22.2704738,18.8863433 22.2704738,23.1708706 C22.2704738,26.0658955 21.4617955,30.9507711 16.4772319,31.0377861 Z M37.7681297,2.04758706 C39.7319451,2.04758706 41.3196758,3.62507463 41.3196758,5.57634328 C41.3196758,7.52761194 39.7319451,9.1050995 37.7681297,9.1050995 C35.8043142,9.1050995 34.2165835,7.52761194 34.2165835,5.57634328 C34.2165835,3.62507463 35.8043142,2.04758706 37.7681297,2.04758706 Z" id="Fill-4"></path> </g> </g> </g> </g> </svg>';

var BUTTON_IMAGE = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKwAAAA8CAYAAAD7V1GbAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAGrlJREFUeNrsXXdYVNe2/50zDRiGIiKoQIKIimC9WBLUWMCGxkKMsbc8fYlGE00CaK7RWILmolGjXowVvRiDlCCiolgABQstCNgQNRRpKoPDwMDMen/AnDsDQzGWaN78vm99wNnl7LPP2vusthcMEaERvA1gGID+ACyhhx4vH9UArgGIA3BJVwVGB8MaA/gWwHSpVGodHx+P3Nxc/VTq8dJhaGiId955Bx07diQAvwBYCyBTqxIRaZIbEd2/desWzZo1i0xMTAiAnvT0SmnAgAEUHh5ORKQiojmaPKrJrIOIiAICAkgkEuknTk9/OS1atIjq8HF9hrUiospt27bpJ0pPrxUtWLBAzbRdNRk2/MqVK/oJ0tNrScHBwURE8WqGdSEicnFx0U+Onl5LsrKyIpVKRUTUjwUwNTExEdevX9erqXq8ligsLER0dDQATGEBDDx27NgbM/jWrVtDIpG8EWMVi8Vo06aNnuNeAM6cOQMAfVkA7W7evPnaD3jWrFm4d+8eiouLIZVKce7cOXTv3p0r37p1K65du4bi4mItEggE+PDDD1FUVITi4mIkJiYiNTUVxcXFKCoqwuDBgxvca+vWrYiLiwMA+Pn5oaioCA8fPkRCQgKuX7+O4uJiFBYWwtbWVudYe/bsiTNnzuDp06coLCxEXl4ePv74Y606+/fvR0JCAmxsbLQYPCEhAf/617/0HFoP2dnZANCWD4BRKBSv9WD9/Pzg7e2NkpISrFy5ElZWVli4cCHS0tLQsWNHZGdnY/LkyWjTpg0iIiIgEAjAsixnZy4tLUVaWhoUCgVGjx4NADh27BgMDAxQVlbW4H6DBw9Gt27dAAA5OTlITU0Fn8/HkCFDoFAocPLkSfD5fOiat969eyMpKQkAEBAQgHv37mHhwoX4+eef4eDgAF9fXwDAu+++C0dHR5w8eRIuLi4AAKFQiP79+4PP5+s5tB6USiUAEIjozoQJE15bgdvV1ZWIiM6fP6913d7enubOncs5N8rKyighIaHZ/uRyOR0/frzJOqdPnyaVStXgOhHRv//970bbMQxDubm5RETUoUMHrbKYmJha20zXrgSALly4oDbX0JYtWwgAGRoaEhFRZGSkXtmqRxMmTCAiuvPaL+W5c+cCABYsWMBdY1kWOTk5yMnJ4a7l5eWhU6dOWLp0KQQCAXg8HuRyOXbt2gWZTPZfXzTDQCQSPfM4TE1NAQBGRkaN1unatSvat2+P7du34+7du1pln332GTIyMjBz5kz4+PjA2toat27dQkpKChYvXoyQkBDExsbqt9JmwL7uA7SzswMAqOXssLAwKJVKVFdX486dO5g4cSKnSbZq1Qr+/v7w8/PDunXrsGnTJo7RNMEwzDOPg8fjNdu2bdu2AIDExMQGZep4DLUSJhaLoVAo8NFHH0EmkyE6Ohp2dnYoKyvj7qXHG8iwWVlZAIBevXoBAE6ePIlt27Zhz549cHBwQMeOHQEAnTp1wvXr12FiYgJjY2MYGxtDLBajoKDglY31/v37AICRI0c2KOvSpQsA4I8//uBkMvViHDJkCEQiEU6fPg2WZfH06VM9Z76pDLt//34AwJEjR2BmZoaAgAAsXrwY3377LQBwn3cDAwNUVVWhvLwcMpkMMpkMFRUVaCJ88oXj9u3bSE9Px7Rp07SsDwYGBti7d6/W8wBATU0NAODq1av47rvv0KlTJ0gkEp2KoB51eN2VLgC0ZMkSTkEJCwujqKgoIiKqqamh/v37EwAqKioiIqKkpCRKT0+njIwMysjIaKD8EBHduHGjyftlZmYS1XI6R5aWlkREFB0d3WRbe3t7evLkCRERXbhwQR11REREixcv1hpH/XtcunSJiIhOnDihV7TeVKULALZs2YKMjAysWLEC48ePBwAEBwdj1apVyMysDZfcsWMH+vfvDzs7O6hUqkb7Onr0KCdmNIbg4GAtGy8AVFZWIjIyEjExMU22zcnJQefOnbF69WrMnDkThoaGiI2NxcaNG3H8+HGu3u7du2FgYKDV1svLCzt37sTFixf1O+mbvMPqSU/qHZbVL1k99EqXHnroGVYPPfQMq8ffjWEZAHxDvedFjzeBYRkG5uN84bo3FL28Z4AvNtTPmB5/KZq0w/IlFhB3G4aifFP0nLEYLh+OwLXNvyLrUIR+5l4SLC0tMXjwYLAsi+rqalhYWCAsLAwlJSX6yWmOYcHjQcB/CmW5ClcOVuDdidaYdGA5bk8dhWvbD+P28b8+usjFxQWdO3cGn89HeXk5srOz8SYEpOuCg4MDlixZgnnz5nFRYeHh4Th8+LCeU1vEsCCwfAZCMYtKVoDEKDnY8sfo7dEFnQesw62oeMT5H8QfVzNf6aCdnJzg7e2NoUOHoqamBnK5HCzLwsHBAQKBAHK5HOHh4QgODkZYWNgb8zLy8/Ph4+ODP/74Axs3bgQA+Pr6/qXBMNbW1nj//fcRFRX1WmQAYptTuHhCBqyAhZEEEIr5uHJVjMy4IhhX5KPPxIH47MxWzNjtC6vOdq9kwBs2bEBmZiYGDhyItWvXws3NDc7OznByckLr1q3xwQcfICMjA1OmTEFoaCju3LmDGTNmvBEMK5fLUVFRof2C2L/WkNOjRw8EBASgb9++b4LSVcuwPBELVsDASEIQGPEQ/7sZcu4yMCjJAV8mxbB5Y/BN3FZM9psPiaXZSxvs6dOn8fXXX8Pf3x8ODg7YtWuXVvigVCpFSEgI+vTpg08++YT7zNYdr3hjoBkPKxAI/tKxqBeQZhD8a7zDMuAJWfA5puVBbAIIDXk4k2aOO3kGsBLJ8PTBPRgJgOnes+GfshMTvp4EvujFTvSxY8fg7u6O7du348svv2y2/r59+3D//n14eXkhKChIL/z9TdCCHZatY9ranyyfhbGEIDTi4cT1VriZJ8Jb5jXgKypQmn8XVtbGWLphCXam/oQRsz1eyCCnT5+OMWPGoLi4GIsWLWpRm1atWqFv374IDQ1ttq5IJIKxsfEzj4thGJiYmLzwl9LSExEMw8DQ8PlNjc/bh0gkemVfguYZVsCCJ2L/u9MKGbBCFhIJQSjmISyjDX7PNcRbJlWQGDKoKStDyeN7cOpih437ViAgcQPee//Pyz88Ho879rxz584WtysoKEBRUVGTdVasWIGYmBhcvnwZ9+/fR25uLvz9/dG5c+cm202ePBknT55EYmIibt68iUePHuHIkSMYPnx4k+26dOmC5cuX48iRI9i+fTtWr16N1atXY8eOHQgKCuIWo1wub7KfoUOH4vjx40hPT0dpaSkyMzPh7e3dLNOMHDkSAQEBAGqP8xw7dgyVlZWoqKiAXC5HQEAArK2tW6z4hoWFcW0VCgWys7Px+eefa9XbvXs3NmzY0Gx/7u7uOHToEBwcHJqxAzQRXiiytKJ+v5wmt8gEeudoDL0TepbeDT9Lbr+dowHHztGg4+fI9bc46hEeRz9m/0pJ1XvpVPkhOiU9RNHSQDpbcYhu0SnKoHMUEOFN/dpZP3NY2dChQ7lg5/fee++FhKo5OztTXl4eFRYW0ldffUUDBw6kUaNGUWJiIhERKZVK+uqrrxq0MzIyosjISCIi2rhxIw0bNowGDx5Mu3fv5sZ44MABnff86aefKC8vjw4ePEghISGkiUuXLpG/vz/169ePANDXX3/NlfXo0UOrny1bthAR0Y8//kgjRoyguXPnklKpJCKilJQUMjU1bfS5N27cSEREPj4+RET06NEj2rp1K/n4+NCJEye4Z+/Tpw/XZuDAgURENGLECO6al5cXN75du3bR0qVLac2aNZSenk5ERKdOneLqXrx4kYiIbGxsmnwnjx8/JiIic3PzJsMLm2XYd0PP0KDTiTTg2DkaGHmOBkWdp0EnztN7py7Q4NMXaFjMBeoXfYl6n7xI/37wK92kPRRfeZDi5YGUUBVIF+gwJSmDiM5vIfr5n3Tw0/HkYGXeYuZat24dERGpVCqqS3T7XOTo6EgKhYJKSkp0lgcGBnIvY9GiRdx1lmUpKytL66i2Js2aNYtrFxISolUWHR1NRKTFCI6OjiSVSnWeMPD19dXJsDt27CAiotGjR2vVZ1mWO16ekJBALMvqfLaFCxdy/f7zn/9sUN6jRw8iIqqoqCBjY2OdDGtjY0NERAUFBTrTsn7zzTdERPTZZ58RALK2tiYior179zb6Tnr16kVERN98881zxsMyDCfD8oQaooHov78zQh7MxEoYGPKw964dLhdK0EFUCYmAwBcKYVpdja6B6cDFO4BYhelebsjc/gn85w1DK7FBi+yAdV8C7gzU8yA0NBQCgQBTp07VWT5nzhzuTNW2bdvQrl07zpzWpUsXbN68mTvloIkDBw7g7NmzAICJEydi0qRJXH8eHh44fPgwrl69ytW/ffs2li1bxn2qly9frvnVa9B/z5498cknn+DatWuIiorSKmvdujV3GtfY2BhCoVC30b0uQceyZcuwZs2aBuVpaWkYMWIEDA0NtcZT/143btzAtGnTUFVV1aB87dq1UKlUmD17NgDg4cOHuHbtGubMmdNoghA/Pz8AwObNm5/TSlBn1qpVuOqYV6RhOaj7mxGyMDdWwcCIxc579ogrMYEVj4GkRoHOQZkwKJYBdkYAqoHiQgglPCxdMgK3flmIzyf1AQOmWQWEZVlYWFg8F7OOHDkSLi4uqK6uRkpKis46SqUSu3fv5v5WM57aMnH+/PlG+1cb+wHg008/BQDMmzePe3G6LBlPnjwBAHh4eDQmsgEAFi5cCAA4d+4cVzZ8+HCEh4cjJSUFoaGhcHd3R7du3VBZWdmkcvXzzz83+gzR0dEoKSnh7le/r9TUVDg5OXGLszF7smZOMfXCVM+FJkxMTLjnaInprNkzXTwhC54BC4ZYgGHAsADDMmCY2p9gwF0zZ5WQVfPxfVVPKJ7ewPSzF4HHVYCNAcAjQEAAjwFqKoF8OSzaG2PzwVkY+I928PL5Tef9NSese/fuXBqgP4Nx48YBAFQqVZOa+PHjx7lJ7tq1K1xdXVvUf3x8PMrKymBqagonJyeIxWKYmdXape3t7RvUr6mpQUJCAkaNGtXo7qP+qqhTJ7Vq1Qrjx4/HnDlz0LFjR8TFxWHEiBEtyj6pZn5LS0uUl5c3Wu/EiROcs6UpL5upqSkGDBiAjh07orq6mutfIBCgsLCQqxcbGwupVIrvvvuOU/rUUCtpPj4+LZpjfnM7LF9Ua9JSKmsZlmVr92WGrWNeRs28tTypsjeBVUEFLCedQHWHcgg+6AA8qQJYFSBgau/IB8ADIAYgIqjYxo9ip6Wlcb97eXlh3759TT6QjY0Nxo8fD7FYjOzsbCiVSojFYsTFxUEsFnNmGCsrq0atCDdu3EBVVRVEIhGMjIzQo0cPrkydS0AXZDIZrl+/Djc3N1hYWIDH4yEvLw/Ozs5wd3eHSCRq8Bl99OgRADS6ENUMq44t6Nu3L8LDwxEYGIiIiAhUV1e/cLOZOndCY+KJhYUFtm3bhilTpnBMzTAM9+8HhEIh9+VQY9WqVdi0aRN69+6N5ORk7vry5cuRk5PT4viPZs1aLCe7MuCLah0IapssZ/ISsRDwGZQ5tIKJVI5vl+1Fv9/v4v4VGZ4mFwG2IsCIBQSo3WUtRUBPSxQ/keLzmfsxybvx6C9Nec3T0xMdOnRotG7Pnj3x448/Yv78+Zg0aRKCg4MRGhqKgwcPQqlUIi8vj6vr7OzcaD+FhYXIz8/nXsaDBw+4sq5duzY5Zep7KBQKSKVSHDhwgJMtdZl3Jk2ahMrKSk6Oqw+1PFpcXAwAePvttxEZGYmQkJA/xawtQVM2aUtLSyQnJ2PKlClYtWoVl0vB1NQUZmZmMDMzQ1VVFdq3b6/VTm2S1JyD4cOHQyQStcgR1EKGZcAXMlpKltpVq77GFzIQ8IGyDuYwlVZg2ccH4ZiWjyKntmB4LEoO3YMsoQCwEQGtBUCP1lAw1fjXulPo4rEDWw4m1eqBTaz2X3/9lfs7MDCwSdvrggUL0L17d7i6unIheWfPnkVubi5u3brF1VUfF9c5KSzL7WjXrl3TktfGjBnT9Cer7tOu3jGDgoIQEhICAFiyZAn27duHzp07o0uXLoiNjUV1dTV69+6tU8ZVjwUArly5AgCQSCRYt27dczkkpFJpk/XqJwHR3Gk3b94MOzs7eHh4YPXq1bh9+zYn+yuVSqhUKtTU1DQQcSorK3HkyBG4u7tzzpYffvgBNTU1LXLuPIPSpeHp0txd6xhZIGBQbmsGszI5Pp1zFB3SC/Hw7dagGhVYsQAQ8PF0XzZwvQxob4DAfZfQ1TMAX/1wFo+kVS0a5BdffMHlGnBzc8OmTZsa3RlLS0s5BUM9yWpDfEhICPf7hAkTGk2MbG9vDysrKwBAREQElEolx7S2trZ4//33Gx1rnz59GuwkH3zwARYsWIATJ07Aw8MDMTExyMrKwoABA2Bvb99sngRAO2OMt7c3l7rpWaAWL5oSa0xMTNC9e3ecOnUKADgxSh2PMWTIENTU1KgTDOv0ehkaGupcFCtWrAAAfPTRR5xO8qy5cJsNBar95DPcbqq5uwoEQLmVKUyfyvHx9HDYpxSh8O1WgIqgAgOoGLxtZQYrE2OEfH8B/YbtwKwvI5D94MkzDTI/Px+jRo3SYuBdu3Y16VKUy+XcC1JPulQq5RILC4XCRmMM/P39AdRmTFR/iufPn88tmu3bt+u899y5c2Fra4vg4GCtpBkAsGvXLowePRo2NjZcP+rEyrpkYc1FCNQmw9u6dSvn/VMrW/Xh4uLCmeLqQx3IEh8fj06dOumso/4aqJUgdSCOeqfPzMwEn8/nFrQmJBIJkpOTwbIsJ1JpIjs7G1lZWfD19eWUr/Xr1z/bqmvKcSC2aUuT86/RDPlNmlKSQlMfpdC0J6k0vSyVZpan0AS6TdMq0un4+xspq/1iujzYm5IGLabfBy2gJ8MXEnnOpzN9h9JoK+sX4qHy8PCgBw8ecMbv4uJi8vX1JUdHR6165ubmNHXqVK7euXPntMqXLVvGlZ0/f5569epF5ubm1Lt3bzp58mSjhvUBAwZQcXExERE9fPiQRo8eTebm5mRnZ0d+fn5ERHT06NFmn0PTOREWFkZCoVCr/JdffuHK9+/fTyNHjqS2bdsSADp8+LCWlyw2NpZWrlxJa9eupZiYGNq2bRtXtz4tXbqUiIhSU1OJiGj9+vVkZ2dHZmZm5O7uznn6vv/++waexjFjxmg5EkpLS8nLy4veeustcnV1pQ0bNnCpnEpKSqigoEDnGDw9PbmxBwUFPXMijaYZ1rYtTS1Nptmq2zSjPI1myNJoVkUazalKo0mUTTMrMijC80dKa+dLcYO+pYSBX1POMF+qGrWC4t+ZTFPbObzwDCDGxsa0cuVKSktL03pxjx8/pqysLEpNTaXk5GTKyMigPXv20Lx583R6yHr16kV79uwhuVxOpaWllJSURFevXqVTp06Rq6tro/dv06YNrV+/ngoKCkihUFBqairFx8fTpUuXaOLEiY22Mzc3p8mTJ9OqVavo7NmzWmPPyMigdu3aEQCSSCQUFBREERERFBYWRleuXKHAwEBycnLi+po3bx5duXKFampquD7Kysro+++/b9TLpelBMzAwoC+//JJ04YsvvtBq079/f3ry5AkNHTqUuzZ16lTOS6eGUqmkVatWcQtSJpNx3jI0krusW7duz8ywDBHdmThxooOuyHyxXVtMzDgBkbEEyuqKOjMWIGONYFBZiTEfxcPuciGkjgJY8Ah2BgbIkd3D3geXsOtBMmpI9VIjd5ydnWFnZwdra2tIJBJUV1ejpKQEt27d0jKHNQdHR0cYGhri7t27zxTdb2trCwsLCxQUFGjZHTXRtm1brFu3DtOmTUNubi6SkpKQlJQEqVSK+fPno2fPngCAu3fvwsXFBQqFosXxu+3bt4e5uTlKS0tblFbU29sbfn5+aNeuHQoKCmBmZgYPDw9YWFjgwYMHOH/+fIMAcj6fDwsLCzx69EjLKsHj8dCvXz9IJBJUVlbiwoULWg4KMzMzlJaW6kyrn5OTAx6P16QsXR8TJkxAaGhodpM7rPFb7WhO9e/0v5RD8+g6/Q+l0xS6Q3NkGXTEcy/FttlA5wf/RPeG76WkQevIt+NIMhcY6nNBafjmS0tLiYjo008/1Zlifv/+/dwu5ePj81LH4+3tTUT0QmIy/iy5u7sTEdGHH374crIXMjy1SZYggwFEFZUYMjkN1lerYNqzE5TVjxCUewE/34tCTkUx9ADn7QkLC0OrVq2wbNky7NixQ6fnafbs2TAzM8O4ceNe2TGUV5kztz7U86BpqnwWNJ9ukwCGIVRACOHTSgyedAvdMkxR1c0UMQ9jse9eCNKl2XoOrYd//OMfnDs2MjKyybpr1qzBuHHjXpojQNNkpWkrflVQ267Hjh0LR0dHLk7hTzNsY/lUGR4LlmFRAT6EMhk8Z5TDIaMNLlkl40haEGJLLus5s4kdVtOjo+m0qA+1GepZDOh/BllZWUhKSnrlp3DXrFnDyerqgPXn+TzcHzt2rE65wai9FX1M+eRDMoocf4f+Yx5EI9uP0cunLSBDQ0PKz88nIiKZTEYeHh6N/h9VIqL4+Pi/7Vy0adOGXFxcyMLC4k/3MW7cOCKibD6AUltbW53qWkV+Ie4fCobLpf74NXwnjgh/RdXjCv322QLI5XJ4enoiPDwcdnZ2iI6ORmJiIqKiolBUVARjY2P06tULY8eORUREBBdJ9ndEUVFRs8eVmkOdFMADEe357bffmuRuIRj9rvknSSwW09KlS+nixYskl8uJiEgqlVJubi4dPXqUPD099fPUAqo7LZECIhqhUCjIzMxMPzGvgAQCAfH5fP1cPCPVnYPbp45hvL5//379xOjptSQrKyu1V89DzbD9iIgmT56snyA9vXYUERFBRHSZiMBFiRPRYiKiGTNm6CdJT68N1R1rVxCRfX2G5Zh2z549Oo8y60lPr4rc3NzozJkzRESP6yQAEBEYHW66AQDWAngvKioKly9fRmZmJqqqql65h0SP/x9QM6OlpSWcnZ3h5uamDoT/DwAfAFyeT6YJv7I7gLEAnAG8jdpjg0r99OrxEsCg9jBBGYA7AJIBhAK4Ub/i/w0A5sxcyOuxyUIAAAAASUVORK5CYII=">';

var HistoryManager = (function(window, querystring){
  var HISTORY_ACTION_SEPARATOR = '_';

  /**
   * HistoryManager class
   * @param  {URLUtils}
   */
  function HistoryManager(urlUtilsObj) {
    var qsObject = querystring.parse(urlUtilsObj.search);
    this.historyActions = qsObject.ha ? qsObject.ha.split(HISTORY_ACTION_SEPARATOR) : [];
  }
  var prototype = HistoryManager.prototype;

  /**
   * Append history action and rewrite URL
   * @param  {string}
   */
  prototype.appendAction = function (action) {
    this.historyActions.push(action);
  };

  /**
   * Takes URLUtils object as parameter and return path with history actions attached.
   * @param  {URLUtils}
   * @return {string}
   */
  prototype.historify = function (urlUtilsObj) {
    var qsObject = querystring.parse(urlUtilsObj.search);
    qsObject.ha = this.historyActions.join(HISTORY_ACTION_SEPARATOR);
    return urlUtilsObj.pathname + '?' + querystring.stringify(qsObject);
  };

  /**
   * Rewrite location using pushState
   * @param  {URLUtils}
   * @return {string}
   */
  prototype.rewritePushState = function (window) {
    if (window.history && window.history.replaceState) {
      history.replaceState(null, null, this.historify(window.location));
    }
  };

  /**
   * Takes Anchor tag, and rewrite its href to contain history
   * @param  {URLUtils}
   */
  prototype.rewriteHref = function (aTag) {
    if (aTag.href) {
      aTag.href = this.historify(aTag);
    }
  };

  /**
   * Return last action in history
   * @return {string}
   */
  prototype.getLastAction = function() {
    var historyActions = this.historyActions;
    return (historyActions.length) ? historyActions[historyActions.length - 1] : null;
  };

  return HistoryManager;
}(window, querystring));
var Detectors = (function(Promise){
  /**
   * Collections of registered detectors
   * @type {Array}
   */
  var registeredDetectors = [];

  /**
   * Register detect
   * Each detect should be a Plain JavaScript Object look like this:
   * {
   *   setup: function () {} // optional
   *   detect: function () {} // required
   *   teardown: function () {} // optional
   * }
   * @param  {detector}
   */
  function register(detector) {
    registeredDetectors.push(detector);
  }

  /**
   * Run a routines in all detectors
   * @param  {string} 'detect', 'setup', or 'teardown'
   * @return {Array of Promise}
   */
  function executeStep(step) {
    var result = [];
    for (var i = 0; i < registeredDetectors.length; i ++) {
      var detector = registeredDetectors[i];
      if (typeof detector[step] == 'function') {
        var promise = detector[step]();
        result.push(promise);
      }
    }
    return result;
  }

  /**
   * Run setup step
   * @return {Promise}
   */
  function setup() {
    return Promise.all(executeStep('setup'));
  }

  /**
   * Run detect step
   * @return {Promise}
   */
  function detect() {
    var result = Promise.race(executeStep('detect'));
    result.then(function(s){
      alert('Success: ' + s);
    }, function(s){
      alert('Failure: ' + s);
    });
    return result;
  }

  /**
   * Run teardown step
   * @return {Promise}
   */
  function teardown() {
    return Promise.all(executeStep('teardown'));
  }

  return {
    register: register,
    setup: setup,
    detect: detect,
    teardown: teardown
  };
}(Promise));
window.RAF_THRESHOLD = 1.5;
/**
 * Use spikes in requestAnimationFrame latency to detect if app launched.
 */
(function(window, Date, Detectors, Promise){
  var requestAnimationFrame = window.requestAnimationFrame;

  var DETECTOR_NAME = 'skewed rAF';
  var DEFAULT_RAF_MEAN = 400; // default starting value for rAFMean
  var EXPECTED_RAF_MEAN = 50; // value below which rAFMean is considered determined
  var RAF_SAMPLE_SIZE = 3; // number of samples to calculate rAFMean
  var MAX_RAF_SAMPLES = 10; // max number of samples to take
  var RAF_THRESHOLD = window.RAF_THRESHOLD || RAF_SAMPLE_SIZE;
  var rAFMean = DEFAULT_RAF_MEAN;
  var running = false;

  if (!requestAnimationFrame) {
    // not supported, do not register this detector
    return;
  }

  function averageArray(array) {
    var result = 0;
    for (var i = 0; i < array.length; i ++) {
      result += array[i];
    }
    return result / array.length;
  }

  Detectors.register({
    setup: function () {
      if (rAFMean < DEFAULT_RAF_MEAN) {
        return Promise.resolve();
      }
      return new Promise(function(resolve, reject){
        var startTime = 0;
        var animationFrameIndex = 0;
        var animationFrameDiff = [];
        function untilAnimationFrameReady() {
          animationFrameDiff[animationFrameIndex % RAF_SAMPLE_SIZE] = Date.now() - startTime;

          if (animationFrameDiff.length == RAF_SAMPLE_SIZE) {
            var average = averageArray(animationFrameDiff);
            if (average < EXPECTED_RAF_MEAN || animationFrameIndex > MAX_RAF_SAMPLES) {
              rAFMean = average;
              return resolve();
            }
          }
          animationFrameIndex++;
          startTime = Date.now();
          requestAnimationFrame(untilAnimationFrameReady);
        }
        untilAnimationFrameReady();
      });
    },
    detect: function() {
      return new Promise(function(resolve, reject){
        running = true;
        var animationFrameLoop = function () {
          var startTime = Date.now();
          requestAnimationFrame(function() {
            var endTime = Date.now();
            if (endTime > startTime + rAFMean * RAF_THRESHOLD) {
              resolve(DETECTOR_NAME + ' ' + (endTime - startTime) + '>' + rAFMean * RAF_THRESHOLD);
            }
            else if (running) {
              animationFrameLoop();
            }
          });
        };
        animationFrameLoop();
      });
    },
    teardown: function () {
      running = false;
      return Promise.resolve();
    }
  });
}(window, Date, Detectors, Promise));
/**
 * Use setTimeout discrepancy to detect if app launched.
 */
(function(Date, setTimeout, Detectors, Promise){
  var DETECTOR_NAME = 'Timer';

  var TIMER_DURATION = 1500;
  var TIMER_TOLERANCE = TIMER_DURATION + 500;

  Detectors.register({
    detect: function() {
      return new Promise(function(resolve, reject){
        var startTime = Date.now();
        setTimeout(function() {
          var endTime = Date.now();
          if (endTime - startTime > TIMER_TOLERANCE) {
            resolve(DETECTOR_NAME);
          }
          else {
            reject(DETECTOR_NAME);
          }
        }, TIMER_DURATION);
      });
    }
  });
}(Date, setTimeout, Detectors, Promise));
/**
 * Use visibility API to detect if app launched.
 */
(function(document, Detectors, Promise){
  var DETECTOR_NAME = 'Visibility API';

  var visibilitychangeEvent, hiddenProperty;
  if (typeof document.hidden !== 'undefined') {
    visibilitychangeEvent = 'visibilitychange';
    hiddenProperty = 'hidden';
  } else if (typeof document.webkitHidden !== 'undefined') {
    visibilitychangeEvent = 'webkitvisibilitychange';
    hiddenProperty = 'webkitHidden';
  }
  else {
    // not supported, do not register this detector
    return;
  }

  Detectors.register({
    detect: function() {
      return new Promise(function(resolve, reject){
        var successCallback = function () {
          document.removeEventListener(visibilitychangeEvent, successCallback);
          resolve(DETECTOR_NAME);
        };
        document.addEventListener(visibilitychangeEvent, successCallback);
      });
    }
  });
}(document, Detectors, Promise));
var Launcher = (function(Detectors){
  function launchApp(url) {
    var detectPromise = Detectors.setup().then(function(){
      var promise = Detectors.detect();
      Launcher.launch(url);
      return promise;
    });

    detectPromise.then(Detectors.teardown, Detectors.teardown);

    return detectPromise;
  }
  return {
    launchApp: launchApp
  };
}(Detectors));

(function(window, Launcher) {
  Launcher.launch = function (url) {
    window.location.replace(url);
  };
}(window, Launcher));
var ACTION_AUTO_LAUNCH = 'al';
var ACTION_AUTO_FALLBACK = 'af';

var ACTION_LAUNCH_SUCCESS = 'ls';
var ACTION_LAUNCH_FAILURE = 'lf';

var ACTION_VIEW_LAUNCH = 'vl';
var ACTION_VIEW_INSTALL = 'vi';
var ACTION_VIEW_DEFAULT = 'vd';
var ACTION_VIEW_TERNARY = 'vt';

var ACTION_USER_INSTALL = 'ui';
var ACTION_USER_LAUNCH = 'ul';
var ACTION_USER_FALLBACK = 'uf';

var RESUMABLE_ACTIONS = [ACTION_VIEW_LAUNCH, ACTION_VIEW_INSTALL, ACTION_VIEW_TERNARY, ACTION_LAUNCH_SUCCESS, ACTION_LAUNCH_FAILURE];

var View = (function(document){
  /**
   * Simple template renderer
   * @param {Plain Old JavaScript Object}
   */
  function render(model, events) {
    document.title = APP_NAME;
    var template = document.getElementById('templ').innerHTML;
    for (var key in model) {
      if (model.hasOwnProperty(key)) {
        template = template.replace(new RegExp('{' + key + '}', 'g'), model[key]);
      }
    }
    document.body.innerHTML = template;

    if (events) {
      for (var eventHash in events) {
        var match = eventHash.match(/^(\S+) (.+)$/);
        if (match) {
          var selector = match[2];
          var eventName = match[1];
          var handler = events[eventHash];
          document.querySelector(selector).addEventListener(eventName, handler);
        }
      }
    }
  }

  function show(router, state) {
    if (document.body.querySelectorAll('.btn').length === 0) {
      render({
          app_icon: ICON_URL,
          app_title: APP_NAME,

          install_button: BUTTON_IMAGE,
          install_link: APP_INSTALL_URL,
          launch_link: APP_LINK,

          fallback_link: FALLBACK_URL,

          bitly_svg: BITLY_SVG,
        }, {
          'click .install .btn': function(evt) { router.route(ACTION_USER_INSTALL); },
          'click .launch .btn': function(evt){ evt.preventDefault(); router.route(ACTION_USER_LAUNCH); },
          'click .btn.fallback': function(evt) { router.route(ACTION_USER_FALLBACK); }
      });
    }
    document.body.className = state || 'both';
  }

  return {
    show: show
  };
}(document));
var Controller = (function(window, Launcher, setTimeout, View){
  function Controller(router) {
    this.router = router;
  }
  var prototype = Controller.prototype;

  prototype.launchApp = function() {
    var router = this.router;

    Launcher.launchApp(APP_LINK)
    .then(function(){
      router.route(ACTION_LAUNCH_SUCCESS);
    })
    .catch(function(){
      router.route(ACTION_LAUNCH_FAILURE);
    });
  };

  prototype.autoLaunchApp = function () {
    this.launchApp();
  };

  prototype.autoFallback = function () {
    window.location.replace(FALLBACK_URL);
  };

  prototype.launchSuccess = function () {
    this.router.route(ACTION_VIEW_LAUNCH);
  };

  prototype.showDefaultInterstitial = function () {
    var router = this.router;
    if (IS_PROMOTE_INSTALL) {
      router.route(ACTION_VIEW_INSTALL);
    }
    else {
      router.route(ACTION_AUTO_FALLBACK);
    }
  };

  prototype.launchFailure = function () {
    this.showDefaultInterstitial();
  };

  prototype.userLaunchApp = function () {
    this.launchApp();
  };

  prototype.userInstall = function () {
    var router = this.router;
    // no op
    // let click event handle it

    // for returning user
    setTimeout(function(){
      router.route(ACTION_VIEW_LAUNCH);
    }, 1000);
  };

  prototype.userFallback = function () {
    // no op
    // let click event handle it
  };

  prototype.showInstallInterstitial = function () {
    View.show(this.router, 'show-install');
  };

  prototype.showAppOpenInterstitial = function () {
    View.show(this.router, 'show-launch');
  };

  prototype.showTernaryInterstitial = function () {
    View.show(this.router, '');
  };

  return Controller;
}(window, Launcher, setTimeout, View));
var Router = (function(window, Controller, HistoryManager){

  function Router(options) {
    options = options || {};
    var historyManager = new HistoryManager(window.location);
    var lastAction = historyManager.getLastAction();

    this.historyManager = historyManager;
    this.controller = new Controller(this);

    if (lastAction) {
      this.resume(lastAction);
    }
    else if (options.autoLaunch) {
      this.route(ACTION_AUTO_LAUNCH);
    }
    else {
      this.route(ACTION_VIEW_TERNARY);
    }
  }
  var prototype = Router.prototype;

  /**
   * Main routing table
   * @param  {string} controller action name
   * @param  {boolean} does not attempt to rewrite URL
   */
  prototype.route = function (action, isResuming) {
    var historyManager = this.historyManager;
    var controller = this.controller;

    if (!isResuming) {
      historyManager.appendAction(action);
      historyManager.rewritePushState(window);
    }
    switch(action) {
      case ACTION_AUTO_LAUNCH:
        controller.autoLaunchApp(this); break;
      case ACTION_AUTO_FALLBACK:
        controller.autoFallback(this); break;

      case ACTION_LAUNCH_SUCCESS:
        controller.launchSuccess(this); break;
      case ACTION_LAUNCH_FAILURE:
        controller.launchFailure(this); break;

      case ACTION_VIEW_LAUNCH:
        controller.showAppOpenInterstitial(this); break;
      case ACTION_VIEW_INSTALL:
        controller.showInstallInterstitial(this); break;
      case ACTION_VIEW_TERNARY:
        controller.showTernaryInterstitial(this); break;
      case ACTION_VIEW_DEFAULT:
        controller.showDefaultInterstitial(this); break;

      case ACTION_USER_INSTALL:
        controller.userInstall(this); break;
      case ACTION_USER_LAUNCH:
        controller.userLaunchApp(this); break;
      case ACTION_USER_FALLBACK:
        controller.userFallback(this); break;

      default:
        this.route(ACTION_VIEW_LAUNCH); break;
    }
  };

  /**
   * Resuming route from history
   * @param  {string} controller action name
   */
  prototype.resume = function (lastAction) {
    if (RESUMABLE_ACTIONS.indexOf(lastAction) >= 0) {
      this.route(lastAction, true);
    }
    else {
      this.route(ACTION_VIEW_LAUNCH);
    }
  };

  return Router;
}(window, Controller, HistoryManager));
document.addEventListener('DOMContentLoaded', function(){
  try {
    new Router({autoLaunch: true});
  } catch (e) {
    alert(e);
  }
});

}(window, document, setTimeout));
</script>

<script id="templ" type="text/template">
  <article>
    <section>
      <div><img class="icon" src="{app_icon}" title="{app_title}"></div>
      <div class="install">
        <div><a class="btn" href="{install_link}">{install_button}</a></div>
        <div class="hr"><span>OR</span></div>
      </div>
      <div class="launch">
        <div><a class="btn" href="{launch_link}">OPEN APP</a></div>
        <div class="hr"><span>OR</span></div>
      </div>
      <div><a class="btn fallback" href="{fallback_link}">Continue to mobile site.</a></div>
    </section>
    <footer>POWERED BY <span>{bitly_svg}</span></footer>
  </article>
</script>
</head>
<body></body>
</html>
